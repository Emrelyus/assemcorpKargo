<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Assemcorp Ortak Kargo Paneli</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --primary-red: #c1272d; --dark-grey: #231f20; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; display: flex; flex-direction: column; align-items: center; margin: 0; }
        
        header { 
            background: white; width: 100%; padding: 15px; text-align: center; 
            border-bottom: 4px solid var(--primary-red); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); position: relative; 
        }

        .container { 
            width: 95%; max-width: 1100px; background: white; margin-top: 20px; 
            padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); margin-bottom: 40px; 
        }

        .login-bar { display: flex; gap: 10px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #ddd; align-items: center; }

        table { width: 100%; border-collapse: collapse; }
        th { background: var(--dark-grey); color: white; padding: 12px; text-align: left; font-size: 14px; }
        td { border-bottom: 1px solid #eee; padding: 5px; }

        input { width: 90%; padding: 8px; border: 1px solid transparent; background: transparent; transition: 0.3s; }
        input:enabled { border: 1px solid #ccc; background: white; }
        input:focus { border-color: var(--primary-red); outline: none; }

        .btn-save { background: #28a745; color: white; padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px; display: none; font-weight: bold; }
        button { cursor: pointer; padding: 8px 15px; border-radius: 4px; border: 1px solid #ccc; }
        .btn-primary { background: var(--primary-red); color: white; border: none; }

        /* Pop-up Bildirim Stili */
        #toast {
            visibility: hidden; min-width: 250px; background-color: #28a745; color: #fff; text-align: center;
            border-radius: 4px; padding: 16px; position: fixed; z-index: 100; right: 30px; top: 30px; font-size: 17px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }

        @keyframes fadein { from {right: 0; opacity: 0;} to {right: 30px; opacity: 1;} }
        @keyframes fadeout { from {right: 30px; opacity: 1;} to {right: 0; opacity: 0;} }
    </style>
</head>

<body>
    <header>
        <div style="font-weight: bold; font-size: 24px; color: var(--primary-red);">ASSEM<span style="color: var(--dark-grey);">CORP</span></div>
        <div style="font-size: 14px; color: #666;">Bulut TabanlÄ± Ortak Kargo KayÄ±t Sistemi</div>
    </header>

    <div id="toast">âœ… BaÅŸarÄ±yla Kaydedildi!</div>

    <div class="container">
        <div class="login-bar">
            <input type="password" id="pass" placeholder="YÃ¶netici Åžifresi" style="width: 150px; border: 1px solid #ccc; background: white;">
            <button class="btn-primary" onclick="login()">GiriÅŸ Yap</button>
            <button onclick="location.reload()">Yenile â†»</button>
            <button id="saveBtn" class="btn-save" onclick="saveToCloud()" style="margin-left: auto;">ðŸ’¾ Buluta Kaydet</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width: 30px;">#</th>
                    <th style="width: 130px;">Tarih</th>
                    <th>Personel Ä°sim</th>
                    <th>Kargo FirmasÄ±</th>
                    <th>Kargo Kodu</th>
                    <th style="width: 60px;">Ä°ÅŸlem</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        const firebaseConfig = {
            databaseURL: "https://assemcorp-kargo-default-rtdb.europe-west1.firebasedatabase.app"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const ADMIN_PASS = "3765";
        let isAdmin = false;
        let currentData = {};

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = "";
            for (let i = 0; i < 30; i++) {
                const row = currentData[i] || { tarih: '', isim: '', kargo: '', kod: '' };
                const tr = document.createElement('tr');
                
                // Åžifre girilmediyse kargo kodunu boÅŸ gÃ¶ster
                const displayKod = isAdmin ? (row.kod || '') : '';
                
                tr.innerHTML = `
                    <td>${i + 1}</td>
                    <td><input type="date" id="t-${i}" value="${row.tarih || ''}" ${isAdmin ? '' : 'disabled'}></td>
                    <td><input type="text" id="i-${i}" value="${row.isim || ''}" ${isAdmin ? '' : 'disabled'} oninput="autoFillDate(${i})"></td>
                    <td><input type="text" id="k-${i}" value="${row.kargo || ''}" ${isAdmin ? '' : 'disabled'} ></td>
                    <td><input type="text" id="c-${i}" value="${displayKod}" ${isAdmin ? '' : 'disabled'} placeholder="${isAdmin ? 'Kod girin...' : 'GiriÅŸ gerekli'}" style="color:var(--primary-red); font-weight:bold;"></td>
                    <td><button onclick="deleteRow(${i})" style="background:#dc3545; color:white; border:none; padding:5px 10px; border-radius:3px; font-size:12px; ${isAdmin ? 'display:block;' : 'display:none;'}">Sil</button></td>
                `;
                tbody.appendChild(tr);
            }
        }

        function init() {
            db.ref('kargolar').on('value', (snapshot) => {
                currentData = snapshot.val() || {};
                renderTable();
            });
        }

        function autoFillDate(i) {
            const dateInput = document.getElementById(`t-${i}`);
            if (!dateInput.value) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
        }

        function showToast() {
            const x = document.getElementById("toast");
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }

        function login() {
            if (document.getElementById('pass').value === ADMIN_PASS) {
                isAdmin = true;
                document.getElementById('saveBtn').style.display = "block";
                renderTable(); // KodlarÄ± gÃ¶stermek iÃ§in tabloyu yenile
                alert("HoÅŸ geldiniz, dÃ¼zenleme yetkisi verildi.");
            } else { alert("HatalÄ± Åžifre!"); }
        }

        function saveToCloud() {
            if (!isAdmin) return;
            const updates = {};
            for (let i = 0; i < 30; i++) {
                updates[i] = {
                    tarih: document.getElementById(`t-${i}`).value,
                    isim: document.getElementById(`i-${i}`).value,
                    kargo: document.getElementById(`k-${i}`).value,
                    kod: document.getElementById(`c-${i}`).value
                };
            }
            db.ref('kargolar').set(updates)
                .then(() => showToast()) // Pop-up'Ä± gÃ¶ster
                .catch((err) => alert("Hata: " + err));
        }

        function deleteRow(i) {
            if (!isAdmin) return;
            if (confirm(`${i + 1}. satÄ±rÄ± temizlemek istiyor musunuz?`)) {
                document.getElementById(`t-${i}`).value = '';
                document.getElementById(`i-${i}`).value = '';
                document.getElementById(`k-${i}`).value = '';
                document.getElementById(`c-${i}`).value = '';
                saveToCloud();
            }
        }

        init();
    </script>
</body>
</html>